# **C++ 筆記**  
## 資料結構 Data Structure  

資料結構的用途就是把資料存在設計好的結構裡面  
方便快速達成我們的某些要求  

* 單調隊列  
* 前綴和與差分  
* Sparse Table  
* 分塊  
* 線段樹  
* BIT  

## 1. 單調隊列  

> ### ex1. 經典問題
> 給定一個長度為 $N$ 的陣列 $A$ ，給定一個長度 $K$  
> 對所有 $i = 1, 2, \cdots , N$  
> 輸出 $max_{(i \leq j \leq i+k-1)}A_j$  
> $1 \leq K \leq N \leq 10^6$  

範例：  
$A = \{1, 5, 4, 7, 6, 3, 2, 8\}, K = 3$  
Output = $\{5, 7, 7, 7, 6, 8\}$  

觀察：  
當我們從左往右算過去的時候  
如果 $i < j$ 且 $A_i \leq Aj$ ，那 $A_j$ 比 $A_i$ 來的「更有用」  

定義「沒有用」的就是他在當前範圍內有人比他更有用  
只要好好把這些刪掉，就會有這個條件：  

$i < j \rightarrow A_i > A_j$  

換句話說，一個區間的答案就是他最前面有用的人  

怎麼只維護一個區間內有用的人？  

1. $\{10, 9, 4, 3, 1\} \leftarrow 5$  
2. $\{10, 9, 4, 3\} \leftarrow 5$  
3. $\{10, 9, 4\} \leftarrow 5$  
4. $\{10, 9\} \leftarrow 5$  
5. $\{10, 9, 5\}$  

最前面的人也可能會過期，所以遇到最前面的過期就把他 pop 掉  
這樣會不會導致隊列是空的？  

ans：不可能，因為後面的人至少有一個  

---

## 2. 前綴和與差分  

> ### ex2. 靜態區間和  
> 給定一個長度為 $N$ 的陣列 $A$ ， $Q$ 筆詢問 $\Sigma^{R}_{i=L}A_i$  
> $1 \leq N, Q \leq 10^6$  

$O(NQ)$ 會 TLE，怎麼辦？  
做更簡單一點的事：  

如果 $S_i$ 表示 $A_1 + A_2 + \cdots + A_i$ ，這樣我們就有  
$S_i = S_{i-1} + Ai$  

$O(N)$ 算完，每個查詢 $O(1)$ 回答  
我們稱 $S$ 陣列是 $A$ 陣列的前綴和  

$A_L + A_{L+1} + \cdots + A_R = S_R-S_{L-1}$  

用同樣的方法 $O(N)$ 算完，每個查詢 $O(1)$ 回答  

> ### ex3. 區間修改  
> 給定一個長度為 $N$ 的陣列 $A$ ，接下來有 $Q$ 筆修改：  
> 把 $A_L, A_{L+1}, \cdots , A_R$ 都加上 $C$ ，最後輸出陣列 $A$ 經過全部修改後的樣子  
> $1 \leq N, Q \leq 10^6$  

如果 $A$ 是原本的陣列， $S$ 是他的前綴和  
當 $A_i$ 是 $C$ 的時候  
$Si , Si+1 , \cdots , S_N$ 都會因為 $A_i$ 的影響而多出了 $C$  

利用這個性質，對於每一筆詢問，我們可以把 $A_L$ 加上 $C$  
把 $A_{R+1}$ 扣掉 $C$ ，這樣就能最後一起做前綴和達到我們的目的  

誰的前綴和是 $A$ ？  
假設 $D$ 的前綴和是 $A$ ，則  

$A_i = A_{i-1} + D_i$  

我們稱 $D$ 陣列是 $A$ 陣列的差分  

> ### ex4. 二為前綴和  
> 給定一個大小為 $n \times n$ 的表格，有些格子上有樹  
> $q$ 筆詢問 $(x1, y1)$ 到 $(x2, y2)$ 之間有多少樹  
> $1 \leq n \leq 1000; 1 \leq q \leq 2 \times 10^5$  

同樣的，如果我們想用一樣的技巧，就會有  
$S_{I,J}=\Sigma^{I}_{i=0} \Sigma^{J}_{j=0}A_{i,j}$  

<img width="649" alt="2dprefix_0" src="https://github.com/user-attachments/assets/0daf0fb4-c832-4b37-b5d8-3185ab32478d">  

$S_{i,j}=A_{i,j}+S_{i-1,j}+S_{i,j-1}-S_{i-1,j-1}$  

查詢？  

<img width="682" alt="2dprefix_1" src="https://github.com/user-attachments/assets/408be2ef-45f7-4e75-b7ff-e55b1f2c1fae">  

$\Sigma^{x_2}_{i=x_1}\Sigma^{y_2}_{j=y_1}A_{i,j}=S_{x_2,y_2}-S_{x_1-1,y_2}-S_{x_2,y_1-1}+S_{x_1-1,y_1-1}$  
